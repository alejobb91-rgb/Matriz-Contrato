<form id="formSocialInterventoria" autocomplete="off">
  <h3>Social Interventoria</h3>
  <label>No. Contrato:<br>
    <select id="contratoSocialInterventoria" required></select>
  </label><br><br>

  <label>Nombre Profesional:<br>
    <input type="text" id="nombreProfesionalInterventoria" required>
  </label><br><br>

  <label>Celular:<br>
    <input type="text" id="celularInterventoria" required maxlength="15">
    <span id="errorCelularInterventoria" style="color:red;display:none;"></span>
  </label><br><br>

  <label>Correo Electrónico:<br>
    <input type="email" id="correoInterventoria" required>
    <span id="errorCorreoInterventoria" style="color:red;display:none;"></span>
  </label><br><br>

  <label>Memorando de Aceptación:<br>
    <input type="text" id="memorandoAceptacionInterventoria" required>
  </label><br><br>

  <button type="submit">Asociar Social Interventoria</button>
</form>
<div id="msgSocialInterventoria"></div>

<script>
  function cargarContratosInterventoria() {
    let contratos = JSON.parse(localStorage.getItem('contratos') || "[]");
    let select = document.getElementById('contratoSocialInterventoria');
    select.innerHTML = '<option value="">Seleccione...</option>' +
      contratos.map(c => `<option value="${c.noContrato}">${c.noContrato}</option>`).join('');
  }
  cargarContratosInterventoria();

  // Validación en tiempo real para celular
  document.getElementById('celularInterventoria').addEventListener('input', function() {
    const celular = this.value.trim();
    const errorSpan = document.getElementById('errorCelularInterventoria');
    if (!/^[0-9]{7,15}$/.test(celular)) {
      errorSpan.textContent = 'El celular solo debe contener números y mínimo 7 dígitos.';
      errorSpan.style.display = 'inline';
    } else {
      errorSpan.textContent = '';
      errorSpan.style.display = 'none';
    }
  });

  // Validación en tiempo real para correo
  document.getElementById('correoInterventoria').addEventListener('input', function() {
    const correo = this.value.trim();
    const errorSpan = document.getElementById('errorCorreoInterventoria');
    const correoValido = /^[\w\.-]+@[\w\.-]+\.\w+$/.test(correo);
    if (!correoValido) {
      errorSpan.textContent = 'Ingrese un correo electrónico válido.';
      errorSpan.style.display = 'inline';
    } else {
      errorSpan.textContent = '';
      errorSpan.style.display = 'none';
    }
  });

  document.getElementById('formSocialInterventoria').onsubmit = function(e) {
    e.preventDefault();
    const celular = document.getElementById('celularInterventoria').value.trim();
    const correo = document.getElementById('correoInterventoria').value.trim();
    const celularValido = /^[0-9]{7,15}$/.test(celular);
    const correoValido = /^[\w\.-]+@[\w\.-]+\.\w+$/.test(correo);

    if (!celularValido) {
      document.getElementById('msgSocialInterventoria').innerHTML = `<span style="color:red">El celular solo debe contener números y mínimo 7 dígitos.</span>`;
      return;
    }
    if (!correoValido) {
      document.getElementById('msgSocialInterventoria').innerHTML = `<span style="color:red">Ingrese un correo electrónico válido.</span>`;
      return;
    }

    const datos = {
      noContrato: document.getElementById('contratoSocialInterventoria').value,
      nombreProfesional: document.getElementById('nombreProfesionalInterventoria').value.trim(),
      celular: celular,
      correo: correo,
      memorandoAceptacion: document.getElementById('memorandoAceptacionInterventoria').value.trim()
    };
    let asociados = JSON.parse(localStorage.getItem('asociarSocialInterventoria') || "[]");
    // Validación de duplicados por No. Contrato y Nombre Profesional
    const existe = asociados.some(a => 
      a.noContrato === datos.noContrato &&
      a.nombreProfesional.toLowerCase() === datos.nombreProfesional.toLowerCase()
    );
    if (existe) {
      document.getElementById('msgSocialInterventoria').innerHTML = `<span style="color:red">Ya existe una asociación para este No. Contrato y Nombre Profesional.</span>`;
      return;
    }
    asociados.push(datos);
    localStorage.setItem('asociarSocialInterventoria', JSON.stringify(asociados));
    document.getElementById('msgSocialInterventoria').innerHTML = `
      <b>Social Interventoria asociado correctamente:</b>
      <ul>
        <li><b>No. Contrato:</b> ${datos.noContrato}</li>
        <li><b>Nombre Profesional:</b> ${datos.nombreProfesional}</li>
        <li><b>Celular:</b> ${datos.celular}</li>
        <li><b>Correo Electrónico:</b> ${datos.correo}</li>
        <li><b>Memorando de Aceptación:</b> ${datos.memorandoAceptacion}</li>
      </ul>
    `;
    document.getElementById('formSocialInterventoria').reset();
    cargarContratosInterventoria();
  };
</script>